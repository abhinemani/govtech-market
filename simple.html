<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GovTech TAM & SAM Calculator</title>
  <style>
    :root{
      --bg:#f9fafb; --text:#111827; --muted:#6b7280; --card:#ffffff; --ring:#e5e7eb;
      --indigo:#4f46e5; --green:#059669; --black:#111827;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;background:var(--bg);color:var(--text)}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-size:28px;font-weight:800;margin:0 0 6px}
    p.muted{color:var(--muted);margin:0 0 16px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.1);border:1px solid var(--ring);padding:20px}
    .grid{display:grid;gap:12px}
    .grid-6{grid-template-columns:repeat(6,minmax(0,1fr))}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:900px){.grid-6,.grid-3{grid-template-columns:1fr}}
    label{display:block;font-size:13px;font-weight:600}
    input[type="number"], input[type="text"]{width:100%;padding:8px 10px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}
    .actions{display:flex;gap:10px;margin-top:10px}
    button{border:1px solid #d1d5db;background:#fff;border-radius:10px;padding:8px 14px;font-weight:600;cursor:pointer}
    button:hover{background:#f3f4f6}
    .primary{background:#111827;color:#fff;border-color:#111827}
    .stats{margin:16px 0}
    .stat{border-radius:16px;background:#fff;border:1px solid var(--ring);padding:18px}
    .stat.tam{border-color:#d1d5db}
    .stat.sam{border-color:#c7d2fe}
    .stat.som{border-color:#bbf7d0}
    .stat .label{font-size:11px;text-transform:uppercase;letter-spacing:.07em;color:var(--muted)}
    .stat .value{font-size:28px;font-weight:900;margin-top:6px}
    .stat .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .table-wrap{overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{background:#f3f4f6;text-align:left;padding:10px}
    th.right, td.right{text-align:right}
    tbody td{padding:10px;border-top:1px solid #e5e7eb}
    .pill{display:inline-block;border-radius:10px;padding:6px 10px;font-weight:700;font-size:13px}
    .pill.tam{background:var(--black);color:#fff}
    .pill.sam{background:var(--indigo);color:#fff}
    .pill.som{background:var(--green);color:#fff}
    .footer{font-size:12px;color:var(--muted);margin-top:16px}
    .table-actions{display:flex;justify-content:space-between;align-items:center;padding:12px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>GovTech TAM & SAM Calculator</h1>
      <p class="muted">Estimate market size by government population segment. Enter annual price, expected adoption, and (optionally) win rate to see totals. No external libraries used.</p>
    </header>

    <section class="card">
      <div class="grid grid-6">
        <div>
          <label>Set all Prices ($/yr)</label>
          <input id="globalPrice" type="number" min="0" placeholder="e.g., 15000" />
        </div>
        <div>
          <label>Set all Adoption %</label>
          <input id="globalAdoption" type="number" min="0" max="100" placeholder="e.g., 12" />
        </div>
        <div>
          <label>Set all Win % (optional)</label>
          <input id="globalWin" type="number" min="0" max="100" placeholder="e.g., 30" />
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="applyAll">Apply to all</button>
        <button id="reset">Reset sample</button>
        <button id="download">Download CSV</button>
      </div>
    </section>

    <section class="stats grid grid-3">
      <div class="stat tam">
        <div class="label">TAM</div>
        <div class="value" id="tamTotal">$0</div>
        <div class="sub">Total Addressable (count × price)</div>
      </div>
      <div class="stat sam">
        <div class="label">SAM</div>
        <div class="value" id="samTotal">$0</div>
        <div class="sub">Serviceable (count × adoption × price)</div>
      </div>
      <div class="stat som">
        <div class="label">SOM</div>
        <div class="value" id="somTotal">$0</div>
        <div class="sub">Indicative capture (count × adoption × win × price)</div>
      </div>
    </section>

    <section class="card">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Size</th>
              <th class="right">Gov Count</th>
              <th class="right">Adoption %</th>
              <th class="right">Win %</th>
              <th class="right">Price/Year ($)</th>
              <th class="right">TAM</th>
              <th class="right">SAM</th>
              <th class="right">SOM</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="table-actions">
        <button id="add">Add segment</button>
        <div></div>
      </div>
    </section>

    <footer class="footer">
      Notes: TAM = Σ(count × price). SAM = Σ(count × adoption × price). SOM = Σ(count × adoption × win × price).
      Adoption and win are percentages (0–100). Price is annual subscription or average annualized contract value.
    </footer>
  </div>

  <script>
    (function(){
      const $ = (id) => document.getElementById(id);
      const tbody = $("tbody");
      const tamTotal = $("tamTotal");
      const samTotal = $("samTotal");
      const somTotal = $("somTotal");

      const sample = [
        { id: 1, size: "Small (≤25k)", count: 8000, adoption: 5, win: 30, price: 5000 },
        { id: 2, size: "Medium (25k–250k)", count: 1200, adoption: 10, win: 30, price: 15000 },
        { id: 3, size: "Large (≥250k)", count: 120, adoption: 20, win: 30, price: 50000 },
      ];
      let rows = JSON.parse(JSON.stringify(sample));

      function currency(n){ return isNaN(n) ? "$0" : n.toLocaleString(undefined, {style:"currency",currency:"USD",maximumFractionDigits:0}); }
      function percentToFloat(p){ const x = parseFloat(p); if (isNaN(x)) return 0; return Math.min(Math.max(x,0),100)/100; }

      function calcTotals(){
        return rows.reduce((acc,r)=>{
          const price = parseFloat(r.price)||0;
          const count = parseFloat(r.count)||0;
          const adoption = percentToFloat(r.adoption);
          const win = percentToFloat(r.win||0);
          acc.tam += count*price;
          acc.sam += count*adoption*price;
          acc.som += count*adoption*win*price;
          return acc;
        }, {tam:0,sam:0,som:0});
      }

      function render(){
        tbody.innerHTML = "";
        rows.forEach(r=>{
          const count = parseFloat(r.count)||0;
          const price = parseFloat(r.price)||0;
          const adoption = percentToFloat(r.adoption);
          const win = percentToFloat(r.win||0);
          const tam = count*price;
          const sam = count*adoption*price;
          const som = count*adoption*win*price;

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><input type="text" value="${r.size||""}" data-id="${r.id}" data-field="size"></td>
            <td class="right"><input type="number" value="${r.count||""}" data-id="${r.id}" data-field="count"></td>
            <td class="right"><input type="number" value="${r.adoption||""}" data-id="${r.id}" data-field="adoption" min="0" max="100"></td>
            <td class="right"><input type="number" value="${r.win||""}" data-id="${r.id}" data-field="win" min="0" max="100"></td>
            <td class="right"><input type="number" value="${r.price||""}" data-id="${r.id}" data-field="price" min="0"></td>
            <td class="right"><span class="pill tam">${currency(tam)}</span></td>
            <td class="right"><span class="pill sam">${currency(sam)}</span></td>
            <td class="right"><span class="pill som">${currency(som)}</span></td>
            <td class="right"><button data-remove="${r.id}">Remove</button></td>
          `;
          tbody.appendChild(tr);
        });

        // Wire up inputs and remove buttons
        tbody.querySelectorAll("input").forEach(inp=>{
          inp.addEventListener("input", (e)=>{
            const id = parseInt(e.target.getAttribute("data-id"),10);
            const field = e.target.getAttribute("data-field");
            const row = rows.find(x=>x.id===id);
            if(!row) return;
            row[field] = e.target.value;
            updateTotals();
            // update just this row display without full rerender could be complex;
            // simplest: rerender all for correctness & simplicity
            render();
          }, { passive: true });
        });
        tbody.querySelectorAll("button[data-remove]").forEach(btn=>{
          btn.addEventListener("click",(e)=>{
            const id = parseInt(e.target.getAttribute("data-remove"),10);
            rows = rows.filter(x=>x.id!==id);
            render();
            updateTotals();
          });
        });

        updateTotals();
      }

      function updateTotals(){
        const totals = calcTotals();
        tamTotal.textContent = currency(totals.tam);
        samTotal.textContent = currency(totals.sam);
        somTotal.textContent = currency(totals.som);
      }

      function addRow(){
        const nextId = (rows[rows.length-1]?.id||0)+1;
        rows.push({ id: nextId, size:"", count:"", adoption:"", win:"", price:"" });
        render();
      }

      function applyGlobals(){
        const gp = document.getElementById("globalPrice").value;
        const ga = document.getElementById("globalAdoption").value;
        const gw = document.getElementById("globalWin").value;
        rows = rows.map(r=>({
          ...r,
          price: gp!=="" ? gp : r.price,
          adoption: ga!=="" ? ga : r.adoption,
          win: gw!=="" ? gw : r.win,
        }));
        render();
      }

      function resetSample(){
        rows = JSON.parse(JSON.stringify(sample));
        document.getElementById("globalPrice").value = "";
        document.getElementById("globalAdoption").value = "";
        document.getElementById("globalWin").value = "";
        render();
      }

      function downloadCSV(){
        const header = ["Size","Gov Count","Adoption %","Win % (optional)","Price/Year ($)","TAM ($)","SAM ($)","SOM ($)"];
        const lines = [header.join(",")];
        rows.forEach(r=>{
          const adoption = percentToFloat(r.adoption);
          const win = percentToFloat(r.win||0);
          const price = parseFloat(r.price)||0;
          const count = parseFloat(r.count)||0;
          const tam = count*price;
          const sam = count*adoption*price;
          const som = count*adoption*win*price;
          const esc = (s)=>`"${String(s||"").replace(/\"/g,'\"\"')}"`;
          lines.push([esc(r.size), count, r.adoption||"", r.win||"", price, tam, sam, som].join(","));
        });
        const blob = new Blob([lines.join("\\n")], {type:"text/csv;charset=utf-8;"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "govtech_tam_sam.csv"; a.click();
        setTimeout(()=>URL.revokeObjectURL(url), 1000);
      }

      // Hook up UI buttons
      document.getElementById("add").addEventListener("click", addRow);
      document.getElementById("applyAll").addEventListener("click", applyGlobals);
      document.getElementById("reset").addEventListener("click", resetSample);
      document.getElementById("download").addEventListener("click", downloadCSV);

      // First render
      render();
    })();
  </script>
</body>
</html>
