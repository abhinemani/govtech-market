<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GovTech TAM & SAM Calculator (v3)</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{ --bg:#0b1020; --bg-soft:#0f1630; --text:#e6e9f2; --muted:#9aa3b2; --ring:rgba(255,255,255,.08); --indigo:#7c8cff; --green:#34d399; --accent:#a78bfa; --danger:#ff6b6b; --shadow:0 8px 24px rgba(0,0,0,.35); --radius:16px; }
    @media (prefers-color-scheme: light){ :root{ --bg:#f7f7fb; --bg-soft:#ffffff; --text:#0e1020; --muted:#5b6474; --ring:rgba(12,18,28,.08); --indigo:#4f46e5; --green:#10b981; --accent:#7c3aed; --danger:#e11d48; --shadow:0 8px 24px rgba(12,18,28,.06); } }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; background: radial-gradient(1200px 800px at 10% -10%, rgba(124,140,255,.15), transparent 35%), radial-gradient(1200px 800px at 90% -10%, rgba(167,139,250,.18), transparent 35%), var(--bg); color:var(--text); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    .container{max-width: min(1200px, 100vw); margin: 0 auto; padding: clamp(16px, 4vw, 28px);} h1{ font-weight:800; font-size: clamp(22px, 3.5vw, 32px); letter-spacing:-0.02em; margin: 0 0 6px; } .lead{color:var(--muted); margin: 0 0 16px; font-size: clamp(13px, 2.4vw, 16px); line-height: 1.35;}
    .toolbar{ position: sticky; top: 0; z-index: 50; backdrop-filter: blur(10px); background: color-mix(in srgb, var(--bg) 75%, transparent); border-bottom: 1px solid var(--ring); }
    .toolbar-inner{ max-width: min(1200px, 100vw); margin: 0 auto; padding: 10px clamp(16px, 4vw, 28px); display: grid; gap: 10px; align-items: end; grid-template-columns: 1fr; }
    @media (min-width: 900px){ .toolbar-inner{ grid-template-columns: repeat(7, 1fr); } }
    label{display:block; font-size: 12px; font-weight: 700; letter-spacing:.02em; color: var(--muted);} .input{ width:100%; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--ring); background: var(--bg-soft); color: var(--text); font-size: 15px; outline: none; }
    .input:focus{ box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 30%, transparent); border-color: color-mix(in srgb, var(--accent) 45%, var(--ring)); }
    .btn{ appearance: none; border: 1px solid var(--ring); background: var(--bg-soft); color: var(--text); padding: 12px 14px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: transform .06s ease, background .2s ease; }
    .btn:hover{ transform: translateY(-1px); } .btn:active{ transform: translateY(0); } .btn.primary{ background: linear-gradient(135deg, var(--indigo), var(--accent)); border: none; color: white; } .btn.ghost{ background: transparent; }
    .surface{ background: var(--bg-soft); border: 1px solid var(--ring); border-radius: var(--radius); box-shadow: var(--shadow); } .pad{ padding: clamp(12px, 3.5vw, 20px); }
    .grid{ display: grid; gap: clamp(10px, 2.5vw, 16px); } .grid-3{ grid-template-columns: 1fr; } @media (min-width: 760px){ .grid-3{ grid-template-columns: repeat(3, 1fr); } }
    .stat{ border-radius: 18px; border: 1px solid var(--ring); padding: clamp(14px, 3vw, 18px); background: linear-gradient(180deg, color-mix(in srgb, var(--bg-soft) 85%, transparent), var(--bg-soft)); }
    .stat .label{ font-size: 12px; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); } .stat .value{ font-size: clamp(22px, 4.5vw, 34px); font-weight: 900; margin-top: 6px; } .stat .sub{ font-size: 12px; color: var(--muted); margin-top: 2px; }
    .stat.tam{ outline: 2px solid color-mix(in srgb, var(--text) 12%, transparent); } .stat.sam{ outline: 2px solid color-mix(in srgb, var(--indigo) 35%, transparent); } .stat.som{ outline: 2px solid color-mix(in srgb, var(--green) 40%, transparent); }
    .table-wrap{ overflow:auto; border-radius:14px; border:1px solid var(--ring); max-height:none; }
    table{ width:100%; border-collapse:collapse; font-size:14px; }
    thead th{ position: sticky; top: 64px; background: color-mix(in srgb, var(--bg-soft) 92%, transparent); backdrop-filter: blur(6px); text-align:left; padding:12px; font-weight:800; font-size:12px; letter-spacing:.06em; color:var(--muted); }
    th.right, td.right{ text-align:right; }
    tbody td{ padding:14px 12px; border-top:1px solid var(--ring); vertical-align:middle; }
    tfoot td{ padding:14px 12px; border-top:2px solid var(--ring); font-weight:800; }
    tbody tr:hover{ background: color-mix(in srgb, var(--bg-soft) 85%, transparent); }
    .cell-input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--ring); background:transparent; color:var(--text); }
    .cell-input:focus{ outline:none; border-color: color-mix(in srgb, var(--accent) 40%, var(--ring)); box-shadow:0 0 0 3px color-mix(in srgb, var(--accent) 25%, transparent); }
    .pill{ display:inline-block; border-radius:999px; padding:8px 10px; font-weight:800; font-size:13px; line-height:1; }
    .pill.tam{ background: color-mix(in srgb, var(--text) 86%, transparent); color: var(--bg);} .pill.sam{ background: color-mix(in srgb, var(--indigo) 70%, transparent); color:#fff;} .pill.som{ background: color-mix(in srgb, var(--green) 70%, transparent); color:#062a1a; }
    .fab{ position: fixed; right:16px; bottom:16px; z-index:60; border-radius:999px; padding:14px 16px; font-weight:800; border:none; background: linear-gradient(135deg, var(--indigo), var(--accent)); color:#fff; box-shadow:var(--shadow); cursor:pointer; }
    .version{ font-size:12px; color:var(--muted); margin-top:6px}
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="toolbar-inner">
      <div>
        <label>Set all Prices ($/yr)</label>
        <input id="globalPrice" class="input" type="number" inputmode="decimal" min="0" placeholder="e.g., 15000" />
      </div>
      <div>
        <label>Set all Adoption %</label>
        <input id="globalAdoption" class="input" type="number" inputmode="decimal" min="0" max="100" placeholder="e.g., 12" />
      </div>
      <div>
        <label>Set all Win % (optional)</label>
        <input id="globalWin" class="input" type="number" inputmode="decimal" min="0" max="100" placeholder="e.g., 25" />
      </div>
      <button id="applyAll" class="btn primary">Apply</button>
      <button id="reset" class="btn ghost">Reset</button>
      <button id="download" class="btn ghost">Export CSV</button>
    </div>
  </div>

  <div class="container">
    <header>
      <h1>GovTech TAM & SAM Calculator</h1>
      <p class="lead">All size categories from your sheet are preloaded. Cities + Counties roll up to Total US. Includes SAM #.</p>
      <div class="version">Build: v3</div>
    </header>

    <section class="grid grid-3">
      <div class="surface pad stat tam"><div class="label">TAM</div><div class="value" id="tamTotal">$0</div><div class="sub">Total Addressable (count × price)</div></div>
      <div class="surface pad stat sam"><div class="label">SAM</div><div class="value" id="samTotal">$0</div><div class="sub">Serviceable (count × adoption × price)</div></div>
      <div class="surface pad stat som"><div class="label">SOM</div><div class="value" id="somTotal">$0</div><div class="sub">Indicative capture (count × adoption × win × price)</div></div>
    </section>

    <div class="surface pad" style="margin-top:14px">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Size</th>
              <th class="right">Cities</th>
              <th class="right">Counties</th>
              <th class="right">Total US</th>
              <th class="right">Adoption %</th>
              <th class="right">Win %</th>
              <th class="right">Price/Year ($)</th>
              <th class="right">TAM</th>
              <th class="right">SAM #</th>
              <th class="right">SAM</th>
              <th class="right">SOM</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
          <tfoot>
            <tr>
              <td>Total</td>
              <td class="right" id="sumCities">0</td>
              <td class="right" id="sumCounties">0</td>
              <td class="right" id="sumTotal">0</td>
              <td></td><td></td><td></td>
              <td class="right" id="sumTAM">$0</td>
              <td class="right" id="sumSAMn">0</td>
              <td class="right" id="sumSAM">$0</td>
              <td class="right" id="sumSOM">$0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <button id="add" class="fab" title="Add segment">+ Segment</button>

  <script>
    (function(){
      const $ = (id) => document.getElementById(id);
      const tbody = $("tbody");
      const tamTotal = $("tamTotal");
      const samTotal = $("samTotal");
      const somTotal = $("somTotal");
      const sumCities = $("sumCities"), sumCounties=$("sumCounties"), sumTotal=$("sumTotal"), sumTAM=$("sumTAM"), sumSAMn=$("sumSAMn"), sumSAM=$("sumSAM"), sumSOM=$("sumSOM");

      function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

      // Categories from your image
      const sample = [
        { id:1,  size:"<2.5k",     cities:12723, counties:140, adoption:0.10, win:25, price:500 },
        { id:2,  size:"2.5k-5k",   cities:2068,  counties:170, adoption:0.20, win:25, price:500 },
        { id:3,  size:"5k-10k",    cities:1671,  counties:401, adoption:2,    win:25, price:750 },
        { id:4,  size:"10k-25k",   cities:1555,  counties:823, adoption:10,   win:25, price:1000 },
        { id:5,  size:"25k-50k",   cities:736,   counties:621, adoption:10,   win:25, price:2000 },
        { id:6,  size:"50k-100k",  cities:454,   counties:390, adoption:15,   win:25, price:2500 },
        { id:7,  size:"100k-250k", cities:220,   counties:324, adoption:15,   win:25, price:3500 },
        { id:8,  size:"250k-500k", cities:49,    counties:132, adoption:15,   win:25, price:5000 },
        { id:9,  size:"500k-1M",   cities:24,    counties:97,  adoption:20,   win:25, price:7500 },
        { id:10, size:">1M",       cities:10,    counties:44,  adoption:5,    win:25, price:10000 },
      ];

      let rows = load() || JSON.parse(JSON.stringify(sample));

      function currency(n){ return isNaN(n) ? "$0" : n.toLocaleString(undefined, {style:"currency",currency:"USD",maximumFractionDigits:0}); }
      function percentToFloat(p){ const x = parseFloat(p); if (isNaN(x)) return 0; return Math.min(Math.max(x,0),100)/100; }
      function int(n){ const x = Math.round(n); return isNaN(x) ? 0 : x; }
      function save(){ try{ localStorage.setItem("govtech_tam_sam_rows_v3", JSON.stringify(rows)); }catch(e){} }
      function load(){ try{ return JSON.parse(localStorage.getItem("govtech_tam_sam_rows_v3")||"null"); }catch(e){ return null; } }

      function totals(){
        return rows.reduce((acc,r)=>{
          const cities = parseFloat(r.cities)||0; const counties=parseFloat(r.counties)||0; const total=cities+counties;
          const price = parseFloat(r.price)||0; const adoption = percentToFloat(r.adoption); const win = percentToFloat(r.win||0);
          const tam = total*price; const samn = total*adoption; const sam = samn*price; const som = samn*win*price;
          acc.cities += cities; acc.counties += counties; acc.total += total; acc.tam += tam; acc.samn += samn; acc.sam += sam; acc.som += som; return acc;
        }, {cities:0,counties:0,total:0,tam:0,samn:0,sam:0,som:0});
      }

      function render(){
        tbody.innerHTML = "";
        rows.forEach(r=>{
          const cities = parseFloat(r.cities)||0; const counties=parseFloat(r.counties)||0; const total=cities+counties;
          const price = parseFloat(r.price)||0; const adoption = percentToFloat(r.adoption); const win = percentToFloat(r.win||0);
          const tam = total*price; const samn = total*adoption; const sam = samn*price; const som = samn*win*price;
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><input class="cell-input" type="text" value="${esc(r.size||"")}" data-id="${r.id}" data-field="size"></td>
            <td class="right"><input class="cell-input" type="number" inputmode="numeric" value="${r.cities||""}" data-id="${r.id}" data-field="cities" min="0"></td>
            <td class="right"><input class="cell-input" type="number" inputmode="numeric" value="${r.counties||""}" data-id="${r.id}" data-field="counties" min="0"></td>
            <td class="right">${int(total).toLocaleString()}</td>
            <td class="right"><input class="cell-input" type="number" inputmode="decimal" value="${r.adoption||""}" data-id="${r.id}" data-field="adoption" min="0" max="100"></td>
            <td class="right"><input class="cell-input" type="number" inputmode="decimal" value="${r.win||""}" data-id="${r.id}" data-field="win" min="0" max="100"></td>
            <td class="right"><input class="cell-input" type="number" inputmode="decimal" value="${r.price||""}" data-id="${r.id}" data-field="price" min="0"></td>
            <td class="right"><span class="pill tam">${currency(tam)}</span></td>
            <td class="right">${int(samn).toLocaleString()}</td>
            <td class="right"><span class="pill sam">${currency(sam)}</span></td>
            <td class="right"><span class="pill som">${currency(som)}</span></td>
            <td class="right"><button class="btn" data-remove="${r.id}" style="border-color:var(--danger); color:var(--danger);">Remove</button></td>
          `;
          tbody.appendChild(tr);
        });

        tbody.querySelectorAll("input").forEach(inp=>{
          inp.addEventListener("input", (e)=>{
            const id = parseInt(e.target.getAttribute("data-id"),10);
            const field = e.target.getAttribute("data-field");
            const row = rows.find(x=>x.id===id);
            if(!row) return; row[field] = e.target.value; save(); render();
          });
        });
        tbody.querySelectorAll("button[data-remove]").forEach(btn=>{
          btn.addEventListener("click",(e)=>{ const id = parseInt(e.target.getAttribute("data-remove"),10); rows = rows.filter(x=>x.id!==id); save(); render(); });
        });

        updateTotals();
      }

      function updateTotals(){
        const t = totals();
        tamTotal.textContent = currency(t.tam);
        samTotal.textContent = currency(t.sam);
        somTotal.textContent = currency(t.som);
        sumCities.textContent = t.cities.toLocaleString();
        sumCounties.textContent = t.counties.toLocaleString();
        sumTotal.textContent = t.total.toLocaleString();
        sumTAM.textContent = currency(t.tam);
        sumSAMn.textContent = int(t.samn).toLocaleString();
        sumSAM.textContent = currency(t.sam);
        sumSOM.textContent = currency(t.som);
      }

      function addRow(){ const nextId = (rows[rows.length-1]?.id||0)+1; rows.push({ id: nextId, size:"", cities:"", counties:"", adoption:"", win:"", price:"" }); save(); render(); }
      function applyGlobals(){ const gp=$("globalPrice").value, ga=$("globalAdoption").value, gw=$("globalWin").value; rows = rows.map(r=>({ ...r, price: gp!==""?gp:r.price, adoption: ga!==""?ga:r.adoption, win: gw!==""?gw:r.win })); save(); render(); }
      function resetSample(){ rows = JSON.parse(JSON.stringify(sample)); localStorage.removeItem("govtech_tam_sam_rows_v3"); ["globalPrice","globalAdoption","globalWin"].forEach(id=>$(id).value=""); render(); }
      function downloadCSV(){ const header=["Size","Cities","Counties","Total US","Adoption %","Win %","Price/Year ($)","TAM ($)","SAM #","SAM ($)","SOM ($)"]; const lines=[header.join(",")]; rows.forEach(r=>{ const cities=parseFloat(r.cities)||0, counties=parseFloat(r.counties)||0, total=cities+counties; const adoption=percentToFloat(r.adoption), win=percentToFloat(r.win||0); const price=parseFloat(r.price)||0; const tam=total*price, samn=Math.round(total*adoption), sam=samn*price, som=Math.round(samn*win)*price; const escCSV = s=>`"${String(s||"").replace(/"/g,'""')}"`; lines.push([escCSV(r.size), cities, counties, total, r.adoption||"", r.win||"", price, tam, samn, sam, som].join(",")); }); const blob=new Blob([lines.join("\n")],{type:"text/csv;charset=utf-8;"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="govtech_tam_sam.csv"; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1200); }

      document.getElementById("add").addEventListener("click", addRow);
      document.getElementById("applyAll").addEventListener("click", applyGlobals);
      document.getElementById("reset").addEventListener("click", resetSample);
      document.getElementById("download").addEventListener("click", downloadCSV);

      render();
    })();
  </script>
</body>
</html>